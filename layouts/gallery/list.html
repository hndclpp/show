{{ define "main" }}
<div class="gallery-container">
    <div class="masonry-grid">
        {{ range .Params.images }}
        <div class="masonry-item">
            <a href="{{ .url }}" target="_blank">
                <img src="{{ .url }}" alt="{{ .title }}" loading="lazy">
                <div class="masonry-title">{{ .title }}</div>
            </a>
        </div>
        {{ end }}
    </div>
</div>

<style>
/* 容器样式 */
.gallery-container {
    padding: 20px;
    text-align: center;
}

/* 瀑布流网格 */
.masonry-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* 每列最小宽度 200px */
    gap: 16px; /* 网格间距 */
    grid-auto-rows: 1px; /* 动态计算行高 */
}

.masonry-item {
    grid-row-end: span 1; /* 默认占一行 */
    position: relative;
    background-color: #f0f0f0;
    overflow: hidden;
    border-radius: 8px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.masonry-item img {
    width: 100%;
    display: block;
    opacity: 0; /* 初始隐藏图片 */
    transform: scale(0.95); /* 动画缩放初始状态 */
    transition: opacity 0.3s ease, transform 0.3s ease;
}

.masonry-item img.loaded {
    opacity: 1; /* 图片加载完成后显示 */
    transform: scale(1); /* 恢复正常大小 */
}

.masonry-title {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%; /* 确保标题覆盖整个图片宽度 */
    background: rgba(0, 0, 0, 0.6); /* 半透明背景 */
    color: #fff;
    padding: 10px;
    font-size: 1rem;
    text-align: center;
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
    opacity: 0; /* 初始隐藏标题 */
    transform: translateY(10px); /* 动画初始状态 */
    transition: opacity 0.3s ease, transform 0.3s ease;
}

.masonry-item img.loaded + .masonry-title {
    opacity: 1; /* 图片加载完成后显示标题 */
    transform: translateY(0); /* 标题恢复正常位置 */
}

/* 如果图片高度太小，标题仍会正确对齐 */
.masonry-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
}

/* 响应式适配 */
@media (max-width: 768px) {
    .masonry-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    .masonry-title {
        font-size: 0.9rem;
    }
}

@media (max-width: 480px) {
    .masonry-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    }
    .masonry-title {
        font-size: 0.8rem;
    }
}
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const resizeAllGridItems = () => {
            const grid = document.querySelector(".masonry-grid");
            const items = document.querySelectorAll(".masonry-item");
            for (let item of items) {
                const img = item.querySelector("img");
                const title = item.querySelector(".masonry-title");
                if (img.complete) {
                    img.classList.add("loaded");
                    title.style.display = "block";
                    resizeGridItem(item, grid);
                } else {
                    img.onload = () => {
                        img.classList.add("loaded");
                        title.style.display = "block";
                        resizeGridItem(item, grid);
                    };
                }
            }
        };

        const resizeGridItem = (item, grid) => {
            const rowHeight = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-auto-rows'));
            const rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue('gap'));
            const contentHeight = item.querySelector('img').getBoundingClientRect().height;
            const rowSpan = Math.ceil((contentHeight + rowGap) / (rowHeight + rowGap));
            item.style.gridRowEnd = `span ${rowSpan}`;
        };

        resizeAllGridItems();
        window.addEventListener("resize", resizeAllGridItems);
    });
</script>
{{ end }}
